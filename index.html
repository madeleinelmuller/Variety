<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>main character</title>
  <meta name="color-scheme" content="light dark" />

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8495739879342812" crossorigin="anonymous"></script>

  <style>
    :root {
      --bg: #0f0f12;
      --text: #e9e9ee;
      --muted: #9aa0aa;
      --accent: #7c5cff;
      --accent-2: #00d4ff;
      --good: #39d98a;
      --bad: #ff5470;
      --panel: #141418;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(124,92,255,.25), transparent 60%),
        radial-gradient(1000px 600px at 110% 10%, rgba(0,212,255,.2), transparent 60%),
        var(--bg);
      color: var(--text);
      min-height: 100svh;
      display: grid;
      grid-template-rows: auto 1fr auto;
      overflow-x: hidden;
    }

    .wrap { width: min(1100px, 100% - 32px); margin-inline: auto; }

    /* Top bar */
    .top { position: sticky; top: 0; z-index: 20; background: linear-gradient(to bottom, rgba(15,15,18,0.9), rgba(15,15,18,0.6) 60%, transparent); backdrop-filter: saturate(1.2) blur(10px); padding: 16px 0 8px; }
    .bar { display: flex; align-items: center; gap: 12px; }
    h1 { font-size: clamp(22px, 4vw, 36px); font-weight: 800; letter-spacing: -0.02em; margin: 0; }
    .spacer { flex: 1; }
    .chips { display: flex; flex-wrap: wrap; gap: 8px; }
    .chip, .cta, .toggle {
      -webkit-tap-highlight-color: transparent;
      color: var(--text);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: inset 0 1px rgba(255,255,255,.08), 0 6px 20px rgba(0,0,0,.2);
      font-weight: 700; border-radius: 999px;
      padding: 10px 14px; font-size: 14px; line-height: 1; cursor: pointer;
      transition: transform .15s ease, background .2s ease, border-color .2s ease, opacity .2s ease;
    }
    .chip:hover, .cta:hover, .toggle:hover { transform: translateY(-1px); border-color: rgba(255,255,255,.22); }
    .chip:active, .cta:active, .toggle:active { transform: translateY(0); }
    .cta { background: linear-gradient(135deg, var(--accent), var(--accent-2)); border-color: rgba(255,255,255,.25); color: #0c0c10; text-shadow: 0 1px 0 rgba(255,255,255,.5); }
    .cta.slaying { filter: hue-rotate(33deg) saturate(1.2); }

    /* Layout */
    main { padding: 18px 0 24px; }
    .layout { display: grid; grid-template-columns: 1fr; gap: 16px; align-items: start; }
    .stage { display: grid; place-items: center; }

    /* Chart */
    .chart { width: min(560px, 100%); aspect-ratio: 1/1; position: relative; }
    .chart svg { width: 100%; height: 100%; filter: drop-shadow(0 24px 60px rgba(0,0,0,.45)); }
    .chart .slices { transform-origin: 50% 50%; transition: transform .9s cubic-bezier(.2,.8,.2,1); }
    .chart.spin .slices { transform: rotate(540deg) scale(1.02); }
    .center-tag { position: absolute; inset: 0; display: grid; place-items: center; pointer-events: none; font-weight: 900; letter-spacing: .4px; font-size: clamp(16px, 4.5vw, 26px); text-transform: none; color: #0c0c10; }
    .center-tag span { background: linear-gradient(135deg, var(--accent-2), var(--good)); -webkit-background-clip: text; background-clip: text; color: transparent; text-shadow: 0 0 20px rgba(124,92,255,.2); }
    .slice-label { font-size: 10px; fill: #ffffff; paint-order: stroke; stroke: rgba(0,0,0,.6); stroke-width: 2; text-shadow: none; font-weight: 800; letter-spacing: .2px; }

    .legend { margin-top: 16px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
    .legend .chip { display: inline-flex; align-items: center; gap: 8px; border-radius: 12px; padding: 10px 12px; }
    .dot { width: 10px; height: 10px; border-radius: 999px; box-shadow: 0 0 0 2px rgba(255,255,255,.15) inset; }

    /* Side panel */
    .panel-toggle { position: fixed; right: 10px; top: 50%; translate: 0 -50%; z-index: 30; }
    .panel { position: fixed; right: 0; top: 0; bottom: 0; width: min(320px, 92vw); background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)); border-left: 1px solid rgba(255,255,255,.12); box-shadow: -20px 0 60px rgba(0,0,0,.35); transform: translateX(100%); transition: transform .35s ease; z-index: 25; display: flex; flex-direction: column; }
    .panel.open { transform: translateX(0); }
    .panel-head { display: flex; align-items: center; justify-content: center; padding: 14px; font-weight: 800; }
    .panel-body { padding: 10px 12px 18px; overflow: auto; scrollbar-width: thin; }
    .panel .item { display: flex; flex-wrap: wrap; gap: 6px; padding: 8px; margin: 6px 0; border-radius: 12px; background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.015)); border: 1px solid rgba(255,255,255,.12); cursor: pointer; transition: background .15s ease, border-color .15s ease; }
    .panel .item:hover { border-color: rgba(255,255,255,.22); }

    /* Theme toggles reflection */
    .pretty .chart svg { filter: drop-shadow(0 30px 80px rgba(0,0,0,.55)); }
    .ugly .chart svg { filter: drop-shadow(0 18px 40px rgba(0,0,0,.35)) contrast(1.05) saturate(.85); }

    /* Accessibility helper */
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }

    @media (max-width: 640px) {
      .panel-toggle { right: 8px; top: auto; bottom: 12px; translate: 0 0; }
      .legend { justify-content: center; }
    }
  </style>
</head>
<body class="good pretty">
  <header class="top">
    <div class="wrap bar">
      <h1>main character</h1>
      <div class="spacer"></div>
      <div class="chips">
        <button class="cta" id="slay">slay</button>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <div class="layout">
        <section class="stage">
          <div class="chart" id="chartBox">
            <svg id="chart" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <defs>
                <radialGradient id="glow" cx="50%" cy="45%" r="60%">
                  <stop offset="0%" stop-color="rgba(255,255,255,.35)"/>
                  <stop offset="60%" stop-color="rgba(255,255,255,.04)"/>
                  <stop offset="100%" stop-color="rgba(255,255,255,0)"/>
                </radialGradient>
              </defs>
              <g class="slices" id="slices"></g>
              <g id="labels"></g>
              <circle cx="100" cy="100" r="64" fill="url(#glow)" opacity=".35"></circle>
            </svg>
            <div class="center-tag"><span>dramatic</span></div>
          </div>
          <div class="legend" id="legend"></div>
        </section>
      </div>
    </div>
  </main>

  <button class="toggle panel-toggle" id="panelToggle" aria-label="history" title="history" type="button">
    <span aria-hidden="true">â˜°</span>
    <span class="sr-only">history</span>
  </button>
  <aside class="panel" id="panel">
    <div class="panel-head">main character</div>
    <div class="panel-body" id="history"></div>
  </aside>

  <footer class="foot" style="padding:12px 0 18px; opacity:.4;"></footer>

  <script>
    // Visible trait pool (limited to allowed words)
    const TRAITS = [
      'ugly','pretty','hot','stupid','paranoid','cringe','good vibes','bad vibes','dramatic'
    ];

    // Color mapping for slices
    const COLORS = {
      'ugly': '#ff6b86',
      'pretty': '#00d4ff',
      'hot': '#ff9d4d',
      'stupid': '#f3d35e',
      'paranoid': '#4dc7ff',
      'cringe': '#b184ff',
      'good vibes': '#39d98a',
      'bad vibes': '#ff5470',
      'dramatic': '#ff6ec7'
    };

    const body = document.body;
    const slayBtn = document.getElementById('slay');
    const panel = document.getElementById('panel');
    const panelToggle = document.getElementById('panelToggle');
    const slices = document.getElementById('slices');
    const legend = document.getElementById('legend');
    const chartBox = document.getElementById('chartBox');
    const historyView = document.getElementById('history');
    const labelsGroup = document.getElementById('labels');

    // Simplified header: only slay remains

    // Panel toggle
    panelToggle.addEventListener('click', () => {
      panel.classList.toggle('open');
    });

    // Cookie helpers
    function setCookie(name, value, days) {
      const d = new Date();
      d.setTime(d.getTime() + (days*24*60*60*1000));
      document.cookie = name + '=' + encodeURIComponent(value) + ';expires=' + d.toUTCString() + ';path=/;SameSite=Lax';
    }
    function getCookie(name) {
      const match = document.cookie.match(new RegExp('(?:^|; )' + name.replace(/([.$?*|{}()\[\]\\\/\+^])/g, '\\$1') + '=([^;]*)'));
      return match ? decodeURIComponent(match[1]) : null;
    }

    const COOKIE_KEY = 'vibes-history';

    function loadHistory() {
      try {
        const raw = getCookie(COOKIE_KEY);
        if (!raw) return [];
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      } catch { return []; }
    }

    function saveHistory(list) {
      // keep last 24 entries
      const trimmed = list.slice(-24);
      setCookie(COOKIE_KEY, JSON.stringify(trimmed), 365);
    }

    function pct(p) { return Math.round(p * 100); }

    function renderHistory(list) {
      historyView.innerHTML = '';
      const frag = document.createDocumentFragment();
      list.slice().reverse().forEach((entry, idx) => {
        const item = document.createElement('button');
        item.className = 'item';
        item.setAttribute('type', 'button');
        // chips with percents
        entry.t.forEach((t, i) => {
          const b = document.createElement('span');
          b.className = 'chip';
          b.style.borderColor = 'rgba(255,255,255,.14)';
          b.style.background = 'linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02))';
          b.textContent = `${t} ${pct(entry.w[i])}%`;
          item.appendChild(b);
        });
        item.addEventListener('click', () => {
          applyState(entry.t, entry.w);
        });
        frag.appendChild(item);
      });
      historyView.appendChild(frag);
    }

    // Random helpers
    function pickFour(arr) {
      const pool = arr.slice();
      const out = [];
      for (let i=0;i<4;i++) {
        const j = Math.floor(Math.random() * pool.length);
        out.push(pool.splice(j,1)[0]);
      }
      return out;
    }
    function randomWeights(n) {
      const w = Array.from({length:n}, () => 1 + Math.random());
      const total = w.reduce((a,b)=>a+b,0);
      return w.map(x => x/total);
    }

    // Chart rendering
    function polar(cx, cy, r, a) {
      const rad = (a - 90) * Math.PI / 180; // start at top
      return { x: cx + r * Math.cos(rad), y: cy + r * Math.sin(rad) };
    }

    function arcD(cx, cy, rOuter, rInner, start, end) {
      const so = polar(cx, cy, rOuter, start);
      const eo = polar(cx, cy, rOuter, end);
      const si = polar(cx, cy, rInner, end);
      const ei = polar(cx, cy, rInner, start);
      const large = (end - start) % 360 > 180 ? 1 : 0;
      return [
        `M ${so.x.toFixed(3)} ${so.y.toFixed(3)}`,
        `A ${rOuter} ${rOuter} 0 ${large} 1 ${eo.x.toFixed(3)} ${eo.y.toFixed(3)}`,
        `L ${si.x.toFixed(3)} ${si.y.toFixed(3)}`,
        `A ${rInner} ${rInner} 0 ${large} 0 ${ei.x.toFixed(3)} ${ei.y.toFixed(3)}`,
        'Z'
      ].join(' ');
    }

    function drawPie(traits, weights) {
      const cx = 100, cy = 100, rO = 90, rI = 55;
      slices.innerHTML = '';
      labelsGroup.innerHTML = '';
      let a = 0;
      const frag = document.createDocumentFragment();
      const labelFrag = document.createDocumentFragment();
      traits.forEach((t, i) => {
        const sweep = weights[i] * 360;
        const path = document.createElementNS('http://www.w3.org/2000/svg','path');
        path.setAttribute('d', arcD(cx, cy, rO, rI, a, a + sweep));
        path.setAttribute('fill', COLORS[t] || '#888');
        path.setAttribute('opacity', '0.98');
        path.style.transition = 'opacity .25s ease';
        frag.appendChild(path);

        // label
        const mid = a + sweep / 2;
        const pos = polar(cx, cy, (rO + rI) / 2 + 10, mid);
        const txt = document.createElementNS('http://www.w3.org/2000/svg','text');
        txt.setAttribute('x', pos.x.toFixed(2));
        txt.setAttribute('y', pos.y.toFixed(2));
        txt.setAttribute('text-anchor', 'middle');
        txt.setAttribute('dominant-baseline', 'middle');
        txt.setAttribute('class', 'slice-label');
        txt.textContent = `${pct(weights[i])}%`;
        labelFrag.appendChild(txt);
        a += sweep;
      });
      slices.appendChild(frag);
      labelsGroup.appendChild(labelFrag);

      // Legend
      legend.innerHTML = '';
      const legFrag = document.createDocumentFragment();
      traits.forEach((t, i) => {
        const b = document.createElement('span');
        b.className = 'chip';
        const dot = document.createElement('span');
        dot.className = 'dot';
        dot.style.background = COLORS[t] || '#888';
        b.appendChild(dot);
        const label = document.createTextNode(' ' + t + ' ' + pct(weights[i]) + '%');
        b.appendChild(label);
        legFrag.appendChild(b);
      });
      legend.appendChild(legFrag);
    }

    function applyState(traits, weights, animate = true) {
      if (animate) {
        chartBox.classList.remove('spin');
        void chartBox.offsetWidth;
        chartBox.classList.add('spin');
      }
      drawPie(traits, weights);
    }

    function generate() {
      const traits = pickFour(TRAITS);
      const weights = randomWeights(4);
      applyState(traits, weights, true);
      const list = loadHistory();
      list.push({ t: traits, w: weights });
      saveHistory(list);
      renderHistory(list);
    }

    // Hook slay
    slayBtn.addEventListener('click', () => {
      slayBtn.classList.add('slaying');
      setTimeout(() => slayBtn.classList.remove('slaying'), 500);
      generate();
    });

    // Boot
    const initialList = loadHistory();
    if (initialList.length) {
      const last = initialList[initialList.length - 1];
      applyState(last.t, last.w, false);
      renderHistory(initialList);
    } else {
      generate();
    }
  </script>
</body>
</html>
